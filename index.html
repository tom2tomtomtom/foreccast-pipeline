<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolling 3-Month Revenue Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        #app { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="login-screen">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Revenue Dashboard</h2>
            <input type="password" id="password-input" placeholder="Enter password" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
                onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()" 
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition text-lg">Access Dashboard</button>
            <p id="error-msg" class="text-red-600 text-sm mt-3 text-center" style="display:none;">Incorrect password</p>
        </div>
    </div>
    <div id="app"></div>

    <script>
    const PASSWORD = 'altshift2025';
    function checkPassword() {
        if (document.getElementById('password-input').value === PASSWORD) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            sessionStorage.setItem('authenticated', 'true');
        } else {
            document.getElementById('error-msg').style.display = 'block';
            document.getElementById('password-input').value = '';
        }
    }
    if (sessionStorage.getItem('authenticated') === 'true') {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
    }
    document.getElementById('password-input')?.focus();
    </script>

    <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Injected data from n8n
    const teamData = {"melbourne":{"dreamTeam":{"name":"Dream Team","dec":{"target":140000,"confirmed":121564,"unconfirmed":12400,"total":133964},"jan":{"target":126018,"confirmed":92768,"unconfirmed":6400,"total":99168},"feb":{"target":161460,"confirmed":62868,"unconfirmed":27200,"total":90068},"rolling":{"target":427478,"confirmed":277200,"unconfirmed":46000,"total":323200}},"goGetters":{"name":"Go-Getters","dec":{"target":60000,"confirmed":52677.63,"unconfirmed":6400,"total":59077.63},"jan":{"target":90619,"confirmed":42017.149999999994,"unconfirmed":7200,"total":49217.149999999994},"feb":{"target":116106,"confirmed":10875.41,"unconfirmed":8000,"total":18875.41},"rolling":{"target":266725,"confirmed":105570.19,"unconfirmed":21600,"total":127170.19}},"socialContent":{"name":"Social & Content","dec":{"target":125000,"confirmed":97839,"unconfirmed":0,"total":97839},"jan":{"target":103363,"confirmed":70450,"unconfirmed":0,"total":70450},"feb":{"target":132434,"confirmed":56300,"unconfirmed":0,"total":56300},"rolling":{"target":360797,"confirmed":224589,"unconfirmed":0,"total":224589}},"total":{"name":"Melbourne Total","dec":{"target":325000,"confirmed":272080.63,"unconfirmed":18800,"total":290880.63},"jan":{"target":320000,"confirmed":205235.15,"unconfirmed":13600,"total":218835.15},"feb":{"target":410000,"confirmed":130043.41,"unconfirmed":35200,"total":165243.41},"rolling":{"target":1055000,"confirmed":607359.1900000001,"unconfirmed":67600,"total":674959.1900000001}}},"sydney":{"sydney":{"name":"Sydney","dec":{"target":40000,"confirmed":30150,"unconfirmed":0,"total":30150},"jan":{"target":40000,"confirmed":36750,"unconfirmed":0,"total":36750},"feb":{"target":50000,"confirmed":14250,"unconfirmed":0,"total":14250},"rolling":{"target":130000,"confirmed":81150,"unconfirmed":0,"total":81150}},"total":{"name":"Sydney Total","dec":{"target":40000,"confirmed":30150,"unconfirmed":0,"total":30150},"jan":{"target":40000,"confirmed":36750,"unconfirmed":0,"total":36750},"feb":{"target":50000,"confirmed":14250,"unconfirmed":0,"total":14250},"rolling":{"target":130000,"confirmed":81150,"unconfirmed":0,"total":81150}}},"brisbane":{"brisbane":{"name":"Brisbane","dec":{"target":75000,"confirmed":67551.64000000001,"unconfirmed":0,"total":67551.64000000001},"jan":{"target":90000,"confirmed":93711.64,"unconfirmed":0,"total":93711.64},"feb":{"target":100000,"confirmed":93461.64,"unconfirmed":0,"total":93461.64},"rolling":{"target":265000,"confirmed":254724.92000000004,"unconfirmed":0,"total":254724.92000000004}},"total":{"name":"Brisbane Total","dec":{"target":75000,"confirmed":67551.64000000001,"unconfirmed":0,"total":67551.64000000001},"jan":{"target":90000,"confirmed":93711.64,"unconfirmed":0,"total":93711.64},"feb":{"target":100000,"confirmed":93461.64,"unconfirmed":0,"total":93461.64},"rolling":{"target":265000,"confirmed":254724.92000000004,"unconfirmed":0,"total":254724.92000000004}}},"group":{"total":{"name":"Group Total","dec":{"target":440000,"confirmed":369782.27,"unconfirmed":18800,"total":388582.27},"jan":{"target":450000,"confirmed":335696.79,"unconfirmed":13600,"total":349296.79},"feb":{"target":560000,"confirmed":237755.05,"unconfirmed":35200,"total":272955.05},"rolling":{"target":1450000,"confirmed":943234.1100000001,"unconfirmed":67600,"total":1010834.1100000001}}}};
    const clientData = {"dec":{"dreamTeam":[{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Officeworks","team":"Dream Team","revenue":30118},{"client":"Bounce","team":"Dream Team","revenue":25383},{"client":"Simplot","team":"Dream Team","revenue":14500},{"client":"Therabody","team":"Dream Team","revenue":9500}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":20479},{"client":"Origin Energy","team":"Go-Getters","revenue":12400},{"client":"TAC","team":"Go-Getters","revenue":7400},{"client":"VIDA","team":"Go-Getters","revenue":2936},{"client":"NEAMI","team":"Go-Getters","revenue":2666.66}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":31735},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Miso Tasty","team":"Social & Content","revenue":11833},{"client":"Department of Health","team":"Social & Content","revenue":9000},{"client":"Therabody","team":"Social & Content","revenue":8666}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":12000},{"client":"Officeworks","team":"Sydney","revenue":9500},{"client":"Mondelez","team":"Sydney","revenue":5000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750},{"client":"Cancer Council Victoria","team":"Sydney","revenue":900}],"brisbane":[{"client":"Ausbuild","team":"Brisbane","revenue":40578.640000000014},{"client":"Firehouse Subs","team":"Brisbane","revenue":7000},{"client":"Cairns Regional Council","team":"Brisbane","revenue":6833},{"client":"Caravanning Queensland","team":"Brisbane","revenue":6040},{"client":"Softball Australia","team":"Brisbane","revenue":3500}],"melbourne":[{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Ausbuild","team":"Social & Content","revenue":31735},{"client":"Officeworks","team":"Dream Team","revenue":30118},{"client":"Bounce","team":"Dream Team","revenue":25383},{"client":"AFL","team":"Go-Getters","revenue":20479}],"group":[{"client":"Ausbuild","team":"Brisbane","revenue":40578.640000000014},{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Ausbuild","team":"Social & Content","revenue":31735},{"client":"Officeworks","team":"Dream Team","revenue":30118},{"client":"Bounce","team":"Dream Team","revenue":25383}]},"jan":{"dreamTeam":[{"client":"Officeworks","team":"Dream Team","revenue":29518},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250},{"client":"Bounce","team":"Dream Team","revenue":18500},{"client":"Therabody","team":"Dream Team","revenue":9500},{"client":"Simplot","team":"Dream Team","revenue":6000}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":8480},{"client":"Cancer Council Victoria","team":"Go-Getters","revenue":8309.66},{"client":"Department of Health","team":"Go-Getters","revenue":8250.33},{"client":"VIDA","team":"Go-Getters","revenue":7096.5},{"client":"TAC","team":"Go-Getters","revenue":2764}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":29702},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Miso Tasty","team":"Social & Content","revenue":9333},{"client":"Salsas","team":"Social & Content","revenue":7370},{"client":"AFL","team":"Social & Content","revenue":2500}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":18000},{"client":"Mondelez","team":"Sydney","revenue":7500},{"client":"Officeworks","team":"Sydney","revenue":5500},{"client":"Cancer Council Victoria","team":"Sydney","revenue":3000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750}],"brisbane":[{"client":"Firehouse Subs","team":"Brisbane","revenue":54500},{"client":"Ausbuild","team":"Brisbane","revenue":21128.64},{"client":"Caravanning Queensland","team":"Brisbane","revenue":10250},{"client":"Cairns Regional Council","team":"Brisbane","revenue":6833},{"client":"NEAMI","team":"Brisbane","revenue":1000}],"melbourne":[{"client":"Ausbuild","team":"Social & Content","revenue":29702},{"client":"Officeworks","team":"Dream Team","revenue":29518},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Bounce","team":"Dream Team","revenue":18500}],"group":[{"client":"Firehouse Subs","team":"Brisbane","revenue":54500},{"client":"Ausbuild","team":"Social & Content","revenue":29702},{"client":"Officeworks","team":"Dream Team","revenue":29518},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250},{"client":"Ausbuild","team":"Brisbane","revenue":21128.64}]},"feb":{"dreamTeam":[{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Therabody","team":"Dream Team","revenue":9500},{"client":"Simplot","team":"Dream Team","revenue":7000}],"goGetters":[{"client":"Department of Health","team":"Go-Getters","revenue":7050.33},{"client":"NEAMI","team":"Go-Getters","revenue":2666.66},{"client":"Cancer Council Victoria","team":"Go-Getters","revenue":1158.42}],"socialContent":[{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Ausbuild","team":"Social & Content","revenue":18052},{"client":"Miso Tasty","team":"Social & Content","revenue":9333},{"client":"Salsas","team":"Social & Content","revenue":7370},{"client":"Therabody","team":"Social & Content","revenue":2000}],"sydney":[{"client":"Mondelez","team":"Sydney","revenue":7500},{"client":"Officeworks","team":"Sydney","revenue":4000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750}],"brisbane":[{"client":"Firehouse Subs","team":"Brisbane","revenue":57000},{"client":"Ausbuild","team":"Brisbane","revenue":21128.64},{"client":"Caravanning Queensland","team":"Brisbane","revenue":10250},{"client":"Cairns Regional Council","team":"Brisbane","revenue":4083},{"client":"NEAMI","team":"Brisbane","revenue":1000}],"melbourne":[{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Ausbuild","team":"Social & Content","revenue":18052},{"client":"Therabody","team":"Dream Team","revenue":9500}],"group":[{"client":"Firehouse Subs","team":"Brisbane","revenue":57000},{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Ausbuild","team":"Brisbane","revenue":21128.64},{"client":"Boost Juice","team":"Social & Content","revenue":19545}]},"rolling":{"dreamTeam":[{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Officeworks","team":"Dream Team","revenue":81654},{"client":"Bounce","team":"Dream Team","revenue":43883},{"client":"Therabody","team":"Dream Team","revenue":28500},{"client":"Simplot","team":"Dream Team","revenue":27500}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":28959},{"client":"Department of Health","team":"Go-Getters","revenue":16995.21},{"client":"Origin Energy","team":"Go-Getters","revenue":12400},{"client":"Cancer Council Victoria","team":"Go-Getters","revenue":12069.5},{"client":"TAC","team":"Go-Getters","revenue":10164}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":79489},{"client":"Boost Juice","team":"Social & Content","revenue":58635},{"client":"Miso Tasty","team":"Social & Content","revenue":30499},{"client":"Salsas","team":"Social & Content","revenue":22110},{"client":"Therabody","team":"Social & Content","revenue":12666}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":30000},{"client":"Mondelez","team":"Sydney","revenue":20000},{"client":"Officeworks","team":"Sydney","revenue":19000},{"client":"Caravanning Queensland","team":"Sydney","revenue":8250},{"client":"Cancer Council Victoria","team":"Sydney","revenue":3900}],"brisbane":[{"client":"Firehouse Subs","team":"Brisbane","revenue":118500},{"client":"Ausbuild","team":"Brisbane","revenue":82835.92000000001},{"client":"Caravanning Queensland","team":"Brisbane","revenue":26540},{"client":"Cairns Regional Council","team":"Brisbane","revenue":17749},{"client":"Softball Australia","team":"Brisbane","revenue":3500}],"melbourne":[{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Officeworks","team":"Dream Team","revenue":81654},{"client":"Ausbuild","team":"Social & Content","revenue":79489},{"client":"Boost Juice","team":"Social & Content","revenue":58635},{"client":"Bounce","team":"Dream Team","revenue":43883}],"group":[{"client":"Firehouse Subs","team":"Brisbane","revenue":118500},{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Ausbuild","team":"Brisbane","revenue":82835.92000000001},{"client":"Officeworks","team":"Dream Team","revenue":81654},{"client":"Ausbuild","team":"Social & Content","revenue":79489}]}};
    const updateDate = "9 December 2025";

    // Card components
    const Card = ({ children, className = '' }) => (
      <div className={`bg-white rounded-xl shadow-md overflow-hidden ${className}`}>{children}</div>
    );
    const CardHeader = ({ children, className = '' }) => (
      <div className={`px-6 py-4 ${className}`}>{children}</div>
    );
    const CardContent = ({ children, className = '' }) => (
      <div className={`px-6 pb-6 ${className}`}>{children}</div>
    );

    // Chart.js Trend Chart Component
    const TrendChart = ({ data, title }) => {
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      useEffect(() => {
        if (chartInstance.current) chartInstance.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        chartInstance.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.map(d => d.month),
            datasets: [
              {
                label: 'Revenue',
                data: data.map(d => d.revenue),
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 3,
                pointRadius: 6,
                pointBackgroundColor: '#3b82f6'
              },
              {
                label: 'Target',
                data: data.map(d => d.target),
                borderColor: '#ef4444',
                borderDash: [5, 5],
                borderWidth: 3,
                pointRadius: 6,
                pointBackgroundColor: '#ef4444',
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'top' },
              tooltip: {
                callbacks: {
                  label: (ctx) => ctx.dataset.label + ': $' + (ctx.raw/1000).toFixed(0) + 'k'
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (val) => '$' + (val/1000).toFixed(0) + 'k'
                }
              }
            }
          }
        });
        return () => { if (chartInstance.current) chartInstance.current.destroy(); };
      }, [data]);
      
      return <canvas ref={chartRef} style={{height: '300px'}}></canvas>;
    };

    // Melbourne Team Trend Chart
    const TeamTrendChart = ({ data }) => {
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      useEffect(() => {
        if (!data) return;
        if (chartInstance.current) chartInstance.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        chartInstance.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.map(d => d.month),
            datasets: [
              { label: 'Dream Team', data: data.map(d => d['Dream Team']), borderColor: '#3b82f6', borderWidth: 3, pointRadius: 5, tension: 0.3 },
              { label: 'Go-Getters', data: data.map(d => d['Go-Getters']), borderColor: '#8b5cf6', borderWidth: 3, pointRadius: 5, tension: 0.3 },
              { label: 'Social & Content', data: data.map(d => d['Social & Content']), borderColor: '#ec4899', borderWidth: 3, pointRadius: 5, tension: 0.3 }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true, ticks: { callback: (val) => '$' + (val/1000).toFixed(0) + 'k' } } }
          }
        });
        return () => { if (chartInstance.current) chartInstance.current.destroy(); };
      }, [data]);
      
      return <canvas ref={chartRef} style={{height: '300px'}}></canvas>;
    };

    function Rolling3MonthDashboard() {
      const [selectedOffice, setSelectedOffice] = useState('melbourne');
      const [selectedMonth, setSelectedMonth] = useState('rolling');

      const formatCurrency = (value) => `$${(value / 1000).toFixed(0)}k`;
      const formatCurrencyFull = (value) => '$' + value.toLocaleString();

      const WaterfallChart = ({ data, teamName }) => {
        const chartHeight = 320;
        const barWidth = 90;
        const gap = 45;
        const total = data.confirmed + data.unconfirmed;
        const exceeding = total > data.target;
        const maxValue = exceeding ? total * 1.15 : data.target * 1.15;
        const getY = (value) => 40 + chartHeight - (value / maxValue * chartHeight);
        const getHeight = (value) => (value / maxValue * chartHeight);
        const gapValue = exceeding ? 0 : Math.max(0, data.target - total);
        const excessValue = exceeding ? total - data.target : 0;
        const confirmedHeight = getHeight(data.confirmed);
        const confirmedY = getY(data.confirmed);
        const unconfirmedHeight = getHeight(data.unconfirmed);
        const unconfirmedY = getY(total);
        const gapHeight = getHeight(gapValue);
        const gapY = exceeding ? 0 : getY(data.target);
        const targetY = getY(data.target);
        const targetHeight = getHeight(data.target);
        const x1 = 70, x2 = x1 + barWidth + gap, x3 = x2 + barWidth + gap, x4 = x3 + barWidth + gap;

        return (
          <div style={{ height: '420px', width: '100%' }}>
            <svg width="100%" height="100%" viewBox="0 0 680 420" preserveAspectRatio="xMidYMid meet">
              <line x1="50" y1="40" x2="650" y2="40" stroke="#e5e7eb" strokeWidth="1" />
              <line x1="50" y1="360" x2="650" y2="360" stroke="#e5e7eb" strokeWidth="2" />
              <line x1="50" y1={targetY} x2="650" y2={targetY} stroke="#ef4444" strokeWidth="2" strokeDasharray="5,5" />
              <text x="655" y={targetY + 4} fontSize="11" fill="#ef4444" fontWeight="bold">Target</text>
              
              <rect x={x1} y={confirmedY} width={barWidth} height={confirmedHeight} fill="#10b981" stroke="#059669" strokeWidth="2" rx="4" />
              <text x={x1 + barWidth/2} y={confirmedY - 8} fontSize="13" fontWeight="bold" fill="#059669" textAnchor="middle">{formatCurrency(data.confirmed)}</text>
              <text x={x1 + barWidth/2} y={confirmedY - 22} fontSize="10" fill="#059669" textAnchor="middle">{((data.confirmed / data.target) * 100).toFixed(0)}%</text>
              <text x={x1 + barWidth/2} y="390" fontSize="12" fontWeight="bold" textAnchor="middle">Confirmed</text>
              
              <line x1={x1 + barWidth} y1={confirmedY} x2={x2} y2={confirmedY} stroke="#94a3b8" strokeWidth="2" strokeDasharray="3,3" />
              
              {data.unconfirmed > 0 && (
                <>
                  <rect x={x2} y={unconfirmedY} width={barWidth} height={unconfirmedHeight} fill="#fbbf24" stroke="#f59e0b" strokeWidth="2" rx="4" />
                  <text x={x2 + barWidth/2} y={unconfirmedY - 8} fontSize="13" fontWeight="bold" fill="#f59e0b" textAnchor="middle">{formatCurrency(data.unconfirmed)}</text>
                  <text x={x2 + barWidth/2} y={unconfirmedY - 22} fontSize="10" fill="#f59e0b" textAnchor="middle">+{((data.unconfirmed / data.target) * 100).toFixed(1)}%</text>
                </>
              )}
              <rect x={x2} y={confirmedY} width={barWidth} height={confirmedHeight} fill="#10b981" opacity="0.3" rx="4" />
              <text x={x2 + barWidth/2} y="390" fontSize="12" fontWeight="bold" textAnchor="middle">+ Unconfirmed</text>
              
              <line x1={x2 + barWidth} y1={unconfirmedY} x2={x3} y2={unconfirmedY} stroke="#94a3b8" strokeWidth="2" strokeDasharray="3,3" />
              
              {exceeding ? (
                <>
                  <rect x={x3} y={unconfirmedY} width={barWidth} height={getHeight(excessValue)} fill="#d1fae5" stroke="#10b981" strokeWidth="2" strokeDasharray="4,4" rx="4" />
                  <text x={x3 + barWidth/2} y={unconfirmedY - 8} fontSize="13" fontWeight="bold" fill="#10b981" textAnchor="middle">+{formatCurrency(excessValue)}</text>
                  <rect x={x3} y={targetY} width={barWidth} height={targetHeight} fill="#10b981" opacity="0.2" rx="4" />
                  <text x={x3 + barWidth/2} y="390" fontSize="12" fontWeight="bold" textAnchor="middle">Over Target</text>
                </>
              ) : (
                <>
                  <rect x={x3} y={unconfirmedY} width={barWidth} height={confirmedHeight + unconfirmedHeight} fill="#10b981" opacity="0.2" rx="4" />
                  {gapValue > 0 && (
                    <>
                      <rect x={x3} y={gapY} width={barWidth} height={gapHeight} fill="#fee2e2" stroke="#ef4444" strokeWidth="2" strokeDasharray="4,4" rx="4" />
                      <text x={x3 + barWidth/2} y={gapY - 8} fontSize="13" fontWeight="bold" fill="#ef4444" textAnchor="middle">{formatCurrency(gapValue)}</text>
                      <text x={x3 + barWidth/2} y={gapY - 22} fontSize="10" fill="#ef4444" textAnchor="middle">-{((gapValue / data.target) * 100).toFixed(1)}%</text>
                    </>
                  )}
                  <text x={x3 + barWidth/2} y="390" fontSize="12" fontWeight="bold" textAnchor="middle">Gap</text>
                </>
              )}
              
              <line x1={x3 + barWidth} y1={exceeding ? unconfirmedY : targetY} x2={x4} y2={targetY} stroke="#94a3b8" strokeWidth="2" strokeDasharray="3,3" />
              
              <rect x={x4} y={targetY} width={barWidth} height={targetHeight} fill="none" stroke="#ef4444" strokeWidth="3" rx="4" />
              <text x={x4 + barWidth/2} y={targetY - 8} fontSize="13" fontWeight="bold" fill="#ef4444" textAnchor="middle">{formatCurrency(data.target)}</text>
              <text x={x4 + barWidth/2} y="390" fontSize="12" fontWeight="bold" textAnchor="middle">Target</text>
              
              <text x="45" y="45" fontSize="10" fill="#6b7280" textAnchor="end">{formatCurrency(maxValue)}</text>
              <text x="45" y="365" fontSize="10" fill="#6b7280" textAnchor="end">$0</text>
            </svg>
          </div>
        );
      };

      const getCurrentData = () => {
        const office = teamData[selectedOffice];
        if (!office) return [];
        return Object.keys(office).filter(key => key !== 'total').map(teamKey => ({
          key: teamKey, name: office[teamKey].name, data: office[teamKey][selectedMonth]
        }));
      };

      const getOfficeTotal = () => {
        const office = teamData[selectedOffice];
        if (!office || !office.total) return null;
        return { name: office.total.name, data: office.total[selectedMonth] };
      };

      const monthLabel = { dec: 'December', jan: 'January', feb: 'February', rolling: 'Rolling 3-Month (Dec-Feb)' };
      const officeLabel = { melbourne: 'Melbourne', sydney: 'Sydney', brisbane: 'Brisbane', group: 'Group' };

      const getMonthlyTrendData = () => {
        const office = teamData[selectedOffice];
        if (!office || !office.total) return [];
        return [
          { month: 'December', revenue: office.total.dec.total, target: office.total.dec.target },
          { month: 'January', revenue: office.total.jan.total, target: office.total.jan.target },
          { month: 'February', revenue: office.total.feb.total, target: office.total.feb.target }
        ];
      };

      const getTeamTrendData = () => {
        if (selectedOffice !== 'melbourne') return null;
        return [
          { month: 'December', 'Dream Team': teamData.melbourne.dreamTeam.dec.total, 'Go-Getters': teamData.melbourne.goGetters.dec.total, 'Social & Content': teamData.melbourne.socialContent.dec.total },
          { month: 'January', 'Dream Team': teamData.melbourne.dreamTeam.jan.total, 'Go-Getters': teamData.melbourne.goGetters.jan.total, 'Social & Content': teamData.melbourne.socialContent.jan.total },
          { month: 'February', 'Dream Team': teamData.melbourne.dreamTeam.feb.total, 'Go-Getters': teamData.melbourne.goGetters.feb.total, 'Social & Content': teamData.melbourne.socialContent.feb.total }
        ];
      };

      const getTopClients = () => {
        const monthData = clientData[selectedMonth];
        if (!monthData) return [];
        if (selectedOffice === 'group') return monthData.group || [];
        if (selectedOffice === 'melbourne') return monthData.melbourne || [];
        if (selectedOffice === 'sydney') return monthData.sydney || [];
        if (selectedOffice === 'brisbane') return monthData.brisbane || [];
        return [];
      };

      const monthlyTrendData = getMonthlyTrendData();
      const teamTrendData = getTeamTrendData();
      const officeTotal = getOfficeTotal();

      return (
        <div className="w-full max-w-7xl mx-auto p-4 sm:p-6 bg-gray-50 min-h-screen">
          <div className="mb-8">
            <h1 className="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Rolling 3-Month Revenue Dashboard</h1>
            <p className="text-gray-600">December (Current) + January + February (Forward Looking)</p>
            <div className="mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3">
              <p className="text-sm text-blue-900"><strong>üìä Updated:</strong> {updateDate}</p>
            </div>
          </div>

          <div className="mb-4 flex gap-2 flex-wrap">
            {Object.keys(teamData).map(office => (
              <button key={office} onClick={() => setSelectedOffice(office)}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${selectedOffice === office ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-200'}`}>
                {officeLabel[office]}
              </button>
            ))}
          </div>

          <div className="mb-8 flex gap-2 flex-wrap">
            {['dec', 'jan', 'feb', 'rolling'].map(month => (
              <button key={month} onClick={() => setSelectedMonth(month)}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${selectedMonth === month ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-200'}`}>
                {monthLabel[month]}
              </button>
            ))}
          </div>

          {officeTotal && (
            <Card className="mb-6">
              <CardContent className="pt-6">
                <div className="text-center">
                  <h2 className="text-2xl font-bold text-gray-900 mb-4">{officeLabel[selectedOffice]} - {monthLabel[selectedMonth]}</h2>
                  <div className="flex flex-wrap justify-center gap-6">
                    <div><div className="text-sm text-gray-600">Target</div><div className="text-xl font-bold text-gray-900">{formatCurrency(officeTotal.data.target)}</div></div>
                    <div><div className="text-sm text-gray-600">Confirmed</div><div className="text-xl font-bold text-green-600">{formatCurrency(officeTotal.data.confirmed)}</div></div>
                    <div><div className="text-sm text-gray-600">Unconfirmed</div><div className="text-xl font-bold text-yellow-600">{formatCurrency(officeTotal.data.unconfirmed)}</div></div>
                    <div><div className="text-sm text-gray-600">Variance</div><div className={`text-xl font-bold ${officeTotal.data.total >= officeTotal.data.target ? 'text-green-600' : 'text-red-600'}`}>{officeTotal.data.total >= officeTotal.data.target ? '+' : ''}{formatCurrency(officeTotal.data.total - officeTotal.data.target)}</div></div>
                    <div><div className="text-sm text-gray-600">% Complete</div><div className={`text-xl font-bold ${(officeTotal.data.total / officeTotal.data.target) >= 0.95 ? 'text-green-600' : (officeTotal.data.total / officeTotal.data.target) >= 0.85 ? 'text-yellow-600' : 'text-red-600'}`}>{((officeTotal.data.total / officeTotal.data.target) * 100).toFixed(1)}%</div></div>
                  </div>
                </div>
              </CardContent>
            </Card>
          )}

          <Card className="mb-6">
            <CardHeader className="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
              <h2 className="text-xl font-bold">3-Month Rolling Trend - {officeLabel[selectedOffice]}</h2>
              <p className="text-blue-100 text-sm mt-1">December ‚Üí January ‚Üí February progression</p>
            </CardHeader>
            <CardContent className="pt-6">
              <div style={{height: '350px'}}>
                <TrendChart data={monthlyTrendData} title="Revenue vs Target" />
              </div>
              <div className="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4">
                {monthlyTrendData.map((month, idx) => {
                  const variance = month.revenue - month.target;
                  return (
                    <div key={idx} className="bg-gray-50 p-4 rounded-lg">
                      <div className="text-sm text-gray-600 mb-1">{month.month}</div>
                      <div className="text-xl font-bold text-blue-700">{formatCurrency(month.revenue)}</div>
                      <div className="text-sm text-gray-500 mt-1">vs {formatCurrency(month.target)} target</div>
                      <div className={`text-sm font-semibold mt-2 ${variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {variance >= 0 ? '+' : ''}{formatCurrency(variance)} ({((variance / month.target) * 100).toFixed(1)}%)
                      </div>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>

          {officeTotal && (
            <Card className="mb-6">
              <CardHeader className="bg-gradient-to-r from-indigo-600 to-blue-600 text-white">
                <div className="flex justify-between items-center flex-wrap gap-2">
                  <h2 className="text-xl font-bold">{officeTotal.name} - {monthLabel[selectedMonth]}</h2>
                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${(officeTotal.data.total / officeTotal.data.target) >= 0.95 ? 'bg-green-200 text-green-900' : (officeTotal.data.total / officeTotal.data.target) >= 0.85 ? 'bg-yellow-200 text-yellow-900' : 'bg-red-200 text-red-900'}`}>
                    {((officeTotal.data.total / officeTotal.data.target) * 100).toFixed(1)}% Complete
                  </span>
                </div>
              </CardHeader>
              <CardContent className="pt-6">
                <WaterfallChart data={officeTotal.data} teamName={officeTotal.name} />
                <div className="mt-6 bg-blue-50 p-4 rounded-lg">
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div><div className="text-gray-700">Confirmed:</div><div className="font-bold text-green-700">{formatCurrency(officeTotal.data.confirmed)}</div><div className="text-xs text-gray-600">{((officeTotal.data.confirmed / officeTotal.data.target) * 100).toFixed(1)}% of target</div></div>
                    <div><div className="text-gray-700">Unconfirmed:</div><div className="font-bold text-yellow-700">{formatCurrency(officeTotal.data.unconfirmed)}</div></div>
                    <div><div className="text-gray-700">Total Pipeline:</div><div className="font-bold text-blue-700">{formatCurrency(officeTotal.data.total)}</div></div>
                    <div><div className="text-gray-700">Gap to Close:</div><div className={`font-bold ${officeTotal.data.total >= officeTotal.data.target ? 'text-green-700' : 'text-red-700'}`}>{officeTotal.data.total >= officeTotal.data.target ? 'EXCEEDED!' : formatCurrency(Math.max(0, officeTotal.data.target - officeTotal.data.total))}</div></div>
                  </div>
                </div>
              </CardContent>
            </Card>
          )}

          {getCurrentData().map(team => {
            const total = team.data.confirmed + team.data.unconfirmed;
            const pctComplete = (total / team.data.target) * 100;
            return (
              <Card key={team.key} className="mb-6">
                <CardHeader className="bg-gradient-to-r from-green-600 to-teal-600 text-white">
                  <div className="flex justify-between items-center flex-wrap gap-2">
                    <h2 className="text-xl font-bold">{team.name}</h2>
                    <div className="flex gap-4 text-sm">
                      <span>Target: {formatCurrency(team.data.target)}</span>
                      <span>|</span>
                      <span className={pctComplete >= 95 ? 'text-green-200' : pctComplete >= 85 ? 'text-yellow-200' : 'text-red-200'}>{pctComplete.toFixed(1)}% Complete</span>
                    </div>
                  </div>
                </CardHeader>
                <CardContent className="pt-6">
                  <WaterfallChart data={team.data} teamName={team.name} />
                  <div className="mt-6 bg-gray-50 p-4 rounded-lg">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                      <div><div className="text-gray-600">Confirmed:</div><div className="font-bold text-green-700">{formatCurrency(team.data.confirmed)}</div></div>
                      <div><div className="text-gray-600">Unconfirmed:</div><div className="font-bold text-yellow-700">{formatCurrency(team.data.unconfirmed)}</div></div>
                      <div><div className="text-gray-600">Total Pipeline:</div><div className="font-bold text-blue-700">{formatCurrency(total)}</div></div>
                      <div><div className="text-gray-600">Variance:</div><div className={`font-bold ${total >= team.data.target ? 'text-green-700' : 'text-red-700'}`}>{total >= team.data.target ? '+' : ''}{formatCurrency(total - team.data.target)}</div></div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            );
          })}

          {selectedOffice === 'melbourne' && teamTrendData && (
            <Card className="mb-6">
              <CardHeader className="bg-gradient-to-r from-orange-600 to-red-600 text-white">
                <h2 className="text-xl font-bold">Melbourne Team 3-Month Trends</h2>
              </CardHeader>
              <CardContent className="pt-6">
                <div style={{height: '350px'}}>
                  <TeamTrendChart data={teamTrendData} />
                </div>
              </CardContent>
            </Card>
          )}

          <Card className="mb-6">
            <CardHeader className="bg-gradient-to-r from-green-600 to-emerald-600 text-white">
              <h2 className="text-xl font-bold">Top 5 Clients - {officeLabel[selectedOffice]}</h2>
              <p className="text-green-100 text-sm mt-1">{selectedMonth === 'rolling' ? 'Rolling 3-Month Revenue' : monthLabel[selectedMonth] + ' Revenue'}</p>
            </CardHeader>
            <CardContent className="pt-6">
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="px-4 py-3 text-left font-semibold">Rank</th>
                      <th className="px-4 py-3 text-left font-semibold">Client</th>
                      <th className="px-4 py-3 text-left font-semibold">Team</th>
                      <th className="px-4 py-3 text-right font-semibold">Revenue</th>
                    </tr>
                  </thead>
                  <tbody>
                    {getTopClients().map((client, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="px-4 py-3 text-center">
                          <span className={`inline-flex items-center justify-center w-8 h-8 rounded-full font-bold ${idx === 0 ? 'bg-yellow-100 text-yellow-800' : idx === 1 ? 'bg-gray-200 text-gray-800' : idx === 2 ? 'bg-orange-100 text-orange-800' : 'bg-blue-50 text-blue-700'}`}>{idx + 1}</span>
                        </td>
                        <td className="px-4 py-3 font-semibold text-gray-900">{client.client}</td>
                        <td className="px-4 py-3 text-gray-600 text-sm">{client.team}</td>
                        <td className="px-4 py-3 text-right font-bold text-blue-700">{formatCurrency(client.revenue)}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot className="bg-blue-50 font-semibold">
                    <tr>
                      <td colSpan="3" className="px-4 py-3">Top 5 Total</td>
                      <td className="px-4 py-3 text-right text-blue-700">{formatCurrency(getTopClients().reduce((sum, c) => sum + c.revenue, 0))}</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="bg-gradient-to-r from-indigo-600 to-blue-600 text-white">
              <h2 className="text-xl font-bold">Key Insights - {officeLabel[selectedOffice]}</h2>
            </CardHeader>
            <CardContent className="pt-6">
              {officeTotal && (() => {
                const pct = (officeTotal.data.total / officeTotal.data.target) * 100;
                const gap = Math.max(0, officeTotal.data.target - officeTotal.data.total);
                return (
                  <div className="space-y-4">
                    {pct >= 95 ? (
                      <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                        <h3 className="font-bold text-green-900 mb-2">‚úÖ On Track</h3>
                        <p className="text-green-800">{officeLabel[selectedOffice]} is at {pct.toFixed(1)}% of {monthLabel[selectedMonth]} target. Strong performance!</p>
                      </div>
                    ) : pct >= 80 ? (
                      <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                        <h3 className="font-bold text-yellow-900 mb-2">‚ö†Ô∏è Attention Needed</h3>
                        <p className="text-yellow-800">{officeLabel[selectedOffice]} is at {pct.toFixed(1)}% of {monthLabel[selectedMonth]} target. Gap of {formatCurrency(gap)} to close.</p>
                      </div>
                    ) : (
                      <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                        <h3 className="font-bold text-red-900 mb-2">üî¥ Critical Gap</h3>
                        <p className="text-red-800">{officeLabel[selectedOffice]} is at {pct.toFixed(1)}% of {monthLabel[selectedMonth]} target. Significant gap of {formatCurrency(gap)} requires immediate action.</p>
                      </div>
                    )}
                    {officeTotal.data.unconfirmed > 0 && (
                      <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                        <h3 className="font-bold text-blue-900 mb-2">üìä Pipeline Status</h3>
                        <p className="text-blue-800">Unconfirmed pipeline of {formatCurrency(officeTotal.data.unconfirmed)} ({((officeTotal.data.unconfirmed / officeTotal.data.target) * 100).toFixed(1)}% of target). Focus on converting to confirmed revenue.</p>
                      </div>
                    )}
                  </div>
                );
              })()}
            </CardContent>
          </Card>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<Rolling3MonthDashboard />);
    </script>
</body>
</html>