<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rolling 3-Month Revenue Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; -webkit-font-smoothing: antialiased; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        #app { display: none; }
        /* Mobile-first button grid */
        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        @media (min-width: 640px) { .btn-grid { display: flex; flex-wrap: wrap; gap: 8px; } }
        /* Ensure charts don't overflow */
        canvas { max-width: 100%; }
        /* Better touch targets */
        button { min-height: 44px; }
        /* Prevent horizontal scroll on body */
        html, body { overflow-x: hidden; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="login-screen">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md mx-4">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6 text-center">Revenue Dashboard</h2>
            <input type="password" id="password-input" placeholder="Enter password" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-base"
                onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()" 
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition text-base">Access Dashboard</button>
            <p id="error-msg" class="text-red-600 text-sm mt-3 text-center" style="display:none;">Incorrect password</p>
        </div>
    </div>
    <div id="app"></div>

    <script>
    const PASSWORD = 'altshift2025';
    function checkPassword() {
        if (document.getElementById('password-input').value === PASSWORD) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            sessionStorage.setItem('authenticated', 'true');
        } else {
            document.getElementById('error-msg').style.display = 'block';
            document.getElementById('password-input').value = '';
        }
    }
    if (sessionStorage.getItem('authenticated') === 'true') {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
    }
    document.getElementById('password-input')?.focus();
    </script>

    <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const teamData = {"melbourne":{"dreamTeam":{"name":"Dream Team","dec":{"target":140000,"confirmed":138364,"unconfirmed":9200,"total":147564},"jan":{"target":126018,"confirmed":119925,"unconfirmed":16800,"total":136725},"feb":{"target":161460,"confirmed":79368,"unconfirmed":29200,"total":108568},"rolling":{"target":427478,"confirmed":337657,"unconfirmed":55200,"total":392857}},"goGetters":{"name":"Go-Getters","dec":{"target":60000,"confirmed":54722.97,"unconfirmed":0,"total":54722.97},"jan":{"target":90619,"confirmed":51841.149999999994,"unconfirmed":3200,"total":55041.149999999994},"feb":{"target":116106,"confirmed":46335.41,"unconfirmed":0,"total":46335.41},"rolling":{"target":266725,"confirmed":152899.53,"unconfirmed":3200,"total":156099.53}},"socialContent":{"name":"Social & Content","dec":{"target":125000,"confirmed":99927.67,"unconfirmed":0,"total":99927.67},"jan":{"target":103363,"confirmed":91780,"unconfirmed":0,"total":91780},"feb":{"target":132434,"confirmed":67050,"unconfirmed":0,"total":67050},"rolling":{"target":360797,"confirmed":258757.66999999998,"unconfirmed":0,"total":258757.66999999998}},"total":{"name":"Melbourne Total","dec":{"target":325000,"confirmed":293014.64,"unconfirmed":9200,"total":302214.64},"jan":{"target":320000,"confirmed":263546.15,"unconfirmed":20000,"total":283546.15},"feb":{"target":410000,"confirmed":192753.41,"unconfirmed":29200,"total":221953.41},"rolling":{"target":1055000,"confirmed":749314.2000000001,"unconfirmed":58400,"total":807714.2000000001}}},"sydney":{"sydney":{"name":"Sydney","dec":{"target":40000,"confirmed":31750,"unconfirmed":0,"total":31750},"jan":{"target":40000,"confirmed":49750,"unconfirmed":5120,"total":54870},"feb":{"target":50000,"confirmed":27150,"unconfirmed":7680,"total":34830},"rolling":{"target":130000,"confirmed":108650,"unconfirmed":12800,"total":121450}},"total":{"name":"Sydney Total","dec":{"target":40000,"confirmed":31750,"unconfirmed":0,"total":31750},"jan":{"target":40000,"confirmed":49750,"unconfirmed":5120,"total":54870},"feb":{"target":50000,"confirmed":27150,"unconfirmed":7680,"total":34830},"rolling":{"target":130000,"confirmed":108650,"unconfirmed":12800,"total":121450}}},"brisbane":{"brisbane":{"name":"Brisbane","dec":{"target":75000,"confirmed":72768.64000000001,"unconfirmed":0,"total":72768.64000000001},"jan":{"target":90000,"confirmed":55299.64,"unconfirmed":5600,"total":60899.64},"feb":{"target":100000,"confirmed":47378.64,"unconfirmed":10400,"total":57778.64},"rolling":{"target":265000,"confirmed":175446.92,"unconfirmed":16000,"total":191446.92000000004}},"total":{"name":"Brisbane Total","dec":{"target":75000,"confirmed":72768.64000000001,"unconfirmed":0,"total":72768.64000000001},"jan":{"target":90000,"confirmed":55299.64,"unconfirmed":5600,"total":60899.64},"feb":{"target":100000,"confirmed":47378.64,"unconfirmed":10400,"total":57778.64},"rolling":{"target":265000,"confirmed":175446.92,"unconfirmed":16000,"total":191446.92000000004}}},"group":{"total":{"name":"Group Total","dec":{"target":440000,"confirmed":397533.28,"unconfirmed":9200,"total":406733.28},"jan":{"target":450000,"confirmed":368595.79000000004,"unconfirmed":30720,"total":399315.79000000004},"feb":{"target":560000,"confirmed":267282.05,"unconfirmed":47280,"total":314562.05},"rolling":{"target":1450000,"confirmed":1033411.1200000001,"unconfirmed":87200,"total":1120611.12}}}};
    const clientData = {"dec":{"dreamTeam":[{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Officeworks","team":"Dream Team","revenue":32118},{"client":"Bounce","team":"Dream Team","revenue":21383},{"client":"Simplot","team":"Dream Team","revenue":14500},{"client":"Royal Canin","team":"Dream Team","revenue":10228}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":17927},{"client":"Origin Energy","team":"Go-Getters","revenue":12400},{"client":"TAC","team":"Go-Getters","revenue":10164},{"client":"Cleanaway","team":"Go-Getters","revenue":3500},{"client":"VIDA","team":"Go-Getters","revenue":2936}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":31203.67},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Department of Health","team":"Social & Content","revenue":13000},{"client":"Miso Tasty","team":"Social & Content","revenue":9333},{"client":"Therabody","team":"Social & Content","revenue":8666}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":13600},{"client":"Officeworks","team":"Sydney","revenue":9500},{"client":"Mondelez","team":"Sydney","revenue":5000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750},{"client":"Cancer Council Victoria","team":"Sydney","revenue":900}],"brisbane":[{"client":"Ausbuild","team":"Brisbane","revenue":46478.640000000014},{"client":"Firehouse Subs","team":"Brisbane","revenue":9650},{"client":"Caravanning Queensland","team":"Brisbane","revenue":6040},{"client":"Cairns Regional Council","team":"Brisbane","revenue":3500},{"client":"Softball Australia","team":"Brisbane","revenue":3500}],"melbourne":[{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Officeworks","team":"Dream Team","revenue":32118},{"client":"Ausbuild","team":"Social & Content","revenue":31203.67},{"client":"Bounce","team":"Dream Team","revenue":21383},{"client":"Boost Juice","team":"Social & Content","revenue":19545}],"group":[{"client":"Ausbuild","team":"Brisbane","revenue":46478.640000000014},{"client":"Intrepid Travel","team":"Dream Team","revenue":37835},{"client":"Officeworks","team":"Dream Team","revenue":32118},{"client":"Ausbuild","team":"Social & Content","revenue":31203.67},{"client":"Bounce","team":"Dream Team","revenue":21383}]},"jan":{"dreamTeam":[{"client":"Officeworks","team":"Dream Team","revenue":37425},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250},{"client":"Bounce","team":"Dream Team","revenue":14500},{"client":"Royal Canin","team":"Dream Team","revenue":13300},{"client":"Therabody","team":"Dream Team","revenue":9500}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":11950},{"client":"Cancer Council Victoria","team":"Go-Getters","revenue":8309.66},{"client":"VIDA","team":"Go-Getters","revenue":7096.5},{"client":"Loreto","team":"Go-Getters","revenue":6400},{"client":"Department of Health","team":"Go-Getters","revenue":4668.33}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":30452},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Miso Tasty","team":"Social & Content","revenue":9333},{"client":"AFL","team":"Social & Content","revenue":7380},{"client":"Salsas","team":"Social & Content","revenue":7370}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":31000},{"client":"Mondelez","team":"Sydney","revenue":7500},{"client":"Officeworks","team":"Sydney","revenue":5500},{"client":"Cancer Council Victoria","team":"Sydney","revenue":3000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750}],"brisbane":[{"client":"Ausbuild","team":"Brisbane","revenue":29883.64},{"client":"Cairns Regional Council","team":"Brisbane","revenue":10166},{"client":"Caravanning Queensland","team":"Brisbane","revenue":7250},{"client":"Firehouse Subs","team":"Brisbane","revenue":7000},{"client":"NEAMI","team":"Brisbane","revenue":1000}],"melbourne":[{"client":"Officeworks","team":"Dream Team","revenue":37425},{"client":"Ausbuild","team":"Social & Content","revenue":30452},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Bounce","team":"Dream Team","revenue":14500}],"group":[{"client":"Officeworks","team":"Dream Team","revenue":37425},{"client":"ASICS","team":"Sydney","revenue":31000},{"client":"Ausbuild","team":"Social & Content","revenue":30452},{"client":"Ausbuild","team":"Brisbane","revenue":29883.64},{"client":"Intrepid Travel","team":"Dream Team","revenue":28250}]},"feb":{"dreamTeam":[{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Royal Canin","team":"Dream Team","revenue":12500},{"client":"Therabody","team":"Dream Team","revenue":9500},{"client":"Simplot","team":"Dream Team","revenue":7000}],"goGetters":[{"client":"Loreto","team":"Go-Getters","revenue":24400},{"client":"Cleanaway","team":"Go-Getters","revenue":9000},{"client":"Department of Health","team":"Go-Getters","revenue":7050.33},{"client":"NEAMI","team":"Go-Getters","revenue":2666.66},{"client":"AFL","team":"Go-Getters","revenue":2060}],"socialContent":[{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Ausbuild","team":"Social & Content","revenue":18802},{"client":"Miso Tasty","team":"Social & Content","revenue":9333},{"client":"Salsas","team":"Social & Content","revenue":7370},{"client":"Firehouse Subs","team":"Social & Content","revenue":6000}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":12000},{"client":"Mondelez","team":"Sydney","revenue":7500},{"client":"Officeworks","team":"Sydney","revenue":4000},{"client":"Caravanning Queensland","team":"Sydney","revenue":2750},{"client":"Cancer Council Victoria","team":"Sydney","revenue":900}],"brisbane":[{"client":"Ausbuild","team":"Brisbane","revenue":15128.64},{"client":"Firehouse Subs","team":"Brisbane","revenue":13250},{"client":"Cairns Regional Council","team":"Brisbane","revenue":10750},{"client":"Caravanning Queensland","team":"Brisbane","revenue":7250},{"client":"NEAMI","team":"Brisbane","revenue":1000}],"melbourne":[{"client":"Loreto","team":"Go-Getters","revenue":24400},{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Ausbuild","team":"Social & Content","revenue":18802}],"group":[{"client":"Loreto","team":"Go-Getters","revenue":24400},{"client":"Intrepid Travel","team":"Dream Team","revenue":24350},{"client":"Officeworks","team":"Dream Team","revenue":22018},{"client":"Boost Juice","team":"Social & Content","revenue":19545},{"client":"Ausbuild","team":"Social & Content","revenue":18802}]},"rolling":{"dreamTeam":[{"client":"Officeworks","team":"Dream Team","revenue":91561},{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Royal Canin","team":"Dream Team","revenue":36028},{"client":"Bounce","team":"Dream Team","revenue":35883},{"client":"Therabody","team":"Dream Team","revenue":28500}],"goGetters":[{"client":"AFL","team":"Go-Getters","revenue":31937},{"client":"Loreto","team":"Go-Getters","revenue":30800},{"client":"Cleanaway","team":"Go-Getters","revenue":17000},{"client":"Department of Health","team":"Go-Getters","revenue":13413.21},{"client":"Origin Energy","team":"Go-Getters","revenue":12400}],"socialContent":[{"client":"Ausbuild","team":"Social & Content","revenue":80457.67},{"client":"Boost Juice","team":"Social & Content","revenue":58635},{"client":"Miso Tasty","team":"Social & Content","revenue":27999},{"client":"Salsas","team":"Social & Content","revenue":22110},{"client":"Department of Health","team":"Social & Content","revenue":18200}],"sydney":[{"client":"ASICS","team":"Sydney","revenue":56600},{"client":"Mondelez","team":"Sydney","revenue":20000},{"client":"Officeworks","team":"Sydney","revenue":19000},{"client":"Caravanning Queensland","team":"Sydney","revenue":8250},{"client":"Cancer Council Victoria","team":"Sydney","revenue":4800}],"brisbane":[{"client":"Ausbuild","team":"Brisbane","revenue":91490.92000000001},{"client":"Firehouse Subs","team":"Brisbane","revenue":29900},{"client":"Cairns Regional Council","team":"Brisbane","revenue":24416},{"client":"Caravanning Queensland","team":"Brisbane","revenue":20540},{"client":"Softball Australia","team":"Brisbane","revenue":3500}],"melbourne":[{"client":"Officeworks","team":"Dream Team","revenue":91561},{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Ausbuild","team":"Social & Content","revenue":80457.67},{"client":"Boost Juice","team":"Social & Content","revenue":58635},{"client":"Royal Canin","team":"Dream Team","revenue":36028}],"group":[{"client":"Officeworks","team":"Dream Team","revenue":91561},{"client":"Ausbuild","team":"Brisbane","revenue":91490.92000000001},{"client":"Intrepid Travel","team":"Dream Team","revenue":90435},{"client":"Ausbuild","team":"Social & Content","revenue":80457.67},{"client":"Boost Juice","team":"Social & Content","revenue":58635}]}};
    const updateDate = "25 January 2026";

    const Card = ({ children, className = '' }) => (
      <div className={`bg-white rounded-xl shadow-md overflow-hidden ${className}`}>{children}</div>
    );
    const CardHeader = ({ children, className = '' }) => (
      <div className={`px-4 sm:px-6 py-4 ${className}`}>{children}</div>
    );
    const CardContent = ({ children, className = '' }) => (
      <div className={`px-4 sm:px-6 pb-6 ${className}`}>{children}</div>
    );

    const TrendChart = ({ data, title }) => {
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      useEffect(() => {
        if (chartInstance.current) chartInstance.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        chartInstance.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.map(d => d.month),
            datasets: [
              { label: 'Revenue', data: data.map(d => d.revenue), borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 4, pointBackgroundColor: '#3b82f6' },
              { label: 'Target', data: data.map(d => d.target), borderColor: '#ef4444', borderDash: [5, 5], borderWidth: 2, pointRadius: 4, pointBackgroundColor: '#ef4444', fill: false }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'top', labels: { boxWidth: 12, padding: 15, font: { size: 11 } } },
              tooltip: { callbacks: { label: (ctx) => ctx.dataset.label + ': $' + (ctx.raw/1000).toFixed(0) + 'k' } }
            },
            scales: {
              y: { beginAtZero: true, ticks: { callback: (val) => '$' + (val/1000).toFixed(0) + 'k', font: { size: 10 } } },
              x: { ticks: { font: { size: 10 } } }
            }
          }
        });
        return () => { if (chartInstance.current) chartInstance.current.destroy(); };
      }, [data]);
      
      return <div className="h-64 sm:h-80"><canvas ref={chartRef}></canvas></div>;
    };

    const TeamTrendChart = ({ data }) => {
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      useEffect(() => {
        if (!data) return;
        if (chartInstance.current) chartInstance.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        chartInstance.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.map(d => d.month),
            datasets: [
              { label: 'Dream Team', data: data.map(d => d['Dream Team']), borderColor: '#3b82f6', borderWidth: 2, pointRadius: 4, tension: 0.3 },
              { label: 'Go-Getters', data: data.map(d => d['Go-Getters']), borderColor: '#8b5cf6', borderWidth: 2, pointRadius: 4, tension: 0.3 },
              { label: 'Social & Content', data: data.map(d => d['Social & Content']), borderColor: '#ec4899', borderWidth: 2, pointRadius: 4, tension: 0.3 }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top', labels: { boxWidth: 12, padding: 10, font: { size: 10 } } } },
            scales: { 
              y: { beginAtZero: true, ticks: { callback: (val) => '$' + (val/1000).toFixed(0) + 'k', font: { size: 10 } } },
              x: { ticks: { font: { size: 10 } } }
            }
          }
        });
        return () => { if (chartInstance.current) chartInstance.current.destroy(); };
      }, [data]);
      
      return <div className="h-64 sm:h-80"><canvas ref={chartRef}></canvas></div>;
    };

    function Rolling3MonthDashboard() {
      const [selectedOffice, setSelectedOffice] = useState('melbourne');
      const [selectedMonth, setSelectedMonth] = useState('rolling');

      const formatCurrency = (value) => `$${(value / 1000).toFixed(0)}k`;
      const formatCurrencyFull = (value) => '$' + value.toLocaleString();

      // Mobile-optimized Waterfall - simplified for small screens
      const WaterfallChart = ({ data, teamName }) => {
        const total = data.confirmed + data.unconfirmed;
        const exceeding = total > data.target;
        const maxValue = exceeding ? total * 1.15 : data.target * 1.15;
        const gapValue = exceeding ? 0 : Math.max(0, data.target - total);
        const excessValue = exceeding ? total - data.target : 0;
        const pctConfirmed = ((data.confirmed / data.target) * 100).toFixed(0);
        const pctUnconfirmed = ((data.unconfirmed / data.target) * 100).toFixed(1);
        const pctGap = ((gapValue / data.target) * 100).toFixed(1);

        // Use horizontal bars on mobile for better readability
        return (
          <div className="space-y-3">
            {/* Confirmed */}
            <div>
              <div className="flex justify-between text-sm mb-1">
                <span className="font-medium text-gray-700">Confirmed</span>
                <span className="font-bold text-green-600">{formatCurrency(data.confirmed)} ({pctConfirmed}%)</span>
              </div>
              <div className="h-8 bg-gray-200 rounded-lg overflow-hidden">
                <div className="h-full bg-green-500 rounded-lg transition-all" style={{width: `${Math.min(100, (data.confirmed / data.target) * 100)}%`}}></div>
              </div>
            </div>
            
            {/* Unconfirmed */}
            {data.unconfirmed > 0 && (
              <div>
                <div className="flex justify-between text-sm mb-1">
                  <span className="font-medium text-gray-700">+ Unconfirmed (80%)</span>
                  <span className="font-bold text-yellow-600">{formatCurrency(data.unconfirmed)} (+{pctUnconfirmed}%)</span>
                </div>
                <div className="h-8 bg-gray-200 rounded-lg overflow-hidden">
                  <div className="h-full bg-yellow-400 rounded-lg transition-all" style={{width: `${Math.min(100, (data.unconfirmed / data.target) * 100)}%`}}></div>
                </div>
              </div>
            )}
            
            {/* Total Pipeline */}
            <div>
              <div className="flex justify-between text-sm mb-1">
                <span className="font-medium text-gray-700">Total Pipeline</span>
                <span className="font-bold text-blue-600">{formatCurrency(total)} ({((total / data.target) * 100).toFixed(1)}%)</span>
              </div>
              <div className="h-8 bg-gray-200 rounded-lg overflow-hidden relative">
                <div className={`h-full rounded-lg transition-all ${exceeding ? 'bg-green-500' : 'bg-blue-500'}`} style={{width: `${Math.min(100, (total / data.target) * 100)}%`}}></div>
                {/* Target line */}
                <div className="absolute top-0 bottom-0 w-0.5 bg-red-500" style={{left: '100%', transform: 'translateX(-2px)'}}></div>
              </div>
            </div>
            
            {/* Gap or Excess */}
            {exceeding ? (
              <div className="bg-green-50 border border-green-200 rounded-lg p-3 text-center">
                <span className="text-green-700 font-bold">üéâ Exceeding target by {formatCurrency(excessValue)}</span>
              </div>
            ) : gapValue > 0 && (
              <div className="bg-red-50 border border-red-200 rounded-lg p-3 text-center">
                <span className="text-red-700 font-bold">Gap to close: {formatCurrency(gapValue)} (-{pctGap}%)</span>
              </div>
            )}
            
            {/* Target reference */}
            <div className="flex justify-between items-center pt-2 border-t border-gray-200">
              <span className="text-sm text-gray-600">Target</span>
              <span className="font-bold text-red-600">{formatCurrency(data.target)}</span>
            </div>
          </div>
        );
      };

      const getCurrentData = () => {
        const office = teamData[selectedOffice];
        if (!office) return [];
        return Object.keys(office).filter(key => key !== 'total').map(teamKey => ({
          key: teamKey, name: office[teamKey].name, data: office[teamKey][selectedMonth]
        }));
      };

      const getOfficeTotal = () => {
        const office = teamData[selectedOffice];
        if (!office || !office.total) return null;
        return { name: office.total.name, data: office.total[selectedMonth] };
      };

      const monthLabel = { dec: 'December', jan: 'January', feb: 'February', rolling: 'Rolling 3M' };
      const monthLabelFull = { dec: 'December', jan: 'January', feb: 'February', rolling: 'Rolling 3-Month (Dec-Feb)' };
      const officeLabel = { melbourne: 'Melbourne', sydney: 'Sydney', brisbane: 'Brisbane', group: 'Group' };

      const getMonthlyTrendData = () => {
        const office = teamData[selectedOffice];
        if (!office || !office.total) return [];
        return [
          { month: 'Dec', revenue: office.total.dec.total, target: office.total.dec.target },
          { month: 'Jan', revenue: office.total.jan.total, target: office.total.jan.target },
          { month: 'Feb', revenue: office.total.feb.total, target: office.total.feb.target }
        ];
      };

      const getTeamTrendData = () => {
        if (selectedOffice !== 'melbourne') return null;
        return [
          { month: 'Dec', 'Dream Team': teamData.melbourne.dreamTeam.dec.total, 'Go-Getters': teamData.melbourne.goGetters.dec.total, 'Social & Content': teamData.melbourne.socialContent.dec.total },
          { month: 'Jan', 'Dream Team': teamData.melbourne.dreamTeam.jan.total, 'Go-Getters': teamData.melbourne.goGetters.jan.total, 'Social & Content': teamData.melbourne.socialContent.jan.total },
          { month: 'Feb', 'Dream Team': teamData.melbourne.dreamTeam.feb.total, 'Go-Getters': teamData.melbourne.goGetters.feb.total, 'Social & Content': teamData.melbourne.socialContent.feb.total }
        ];
      };

      const getTopClients = () => {
        const monthData = clientData[selectedMonth];
        if (!monthData) return [];
        if (selectedOffice === 'group') return monthData.group || [];
        if (selectedOffice === 'melbourne') return monthData.melbourne || [];
        if (selectedOffice === 'sydney') return monthData.sydney || [];
        if (selectedOffice === 'brisbane') return monthData.brisbane || [];
        return [];
      };

      const monthlyTrendData = getMonthlyTrendData();
      const teamTrendData = getTeamTrendData();
      const officeTotal = getOfficeTotal();

      return (
        <div className="w-full max-w-7xl mx-auto p-3 sm:p-6 bg-gray-50 min-h-screen">
          {/* Header */}
          <div className="mb-6">
            <h1 className="text-xl sm:text-3xl font-bold text-gray-900 mb-1">Rolling 3-Month Revenue</h1>
            <p className="text-sm sm:text-base text-gray-600">Dec (Current) + Jan + Feb (Forward)</p>
            <div className="mt-2 bg-blue-50 border border-blue-200 rounded-lg p-2 sm:p-3">
              <p className="text-xs sm:text-sm text-blue-900"><strong>üìä Updated:</strong> {updateDate}</p>
            </div>
          </div>

          {/* Office Selector */}
          <div className="mb-3 btn-grid">
            {Object.keys(teamData).map(office => (
              <button key={office} onClick={() => setSelectedOffice(office)}
                className={`px-3 py-2 rounded-lg font-medium transition-colors text-sm sm:text-base ${selectedOffice === office ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-200'}`}>
                {officeLabel[office]}
              </button>
            ))}
          </div>

          {/* Month Selector */}
          <div className="mb-6 btn-grid">
            {['dec', 'jan', 'feb', 'rolling'].map(month => (
              <button key={month} onClick={() => setSelectedMonth(month)}
                className={`px-3 py-2 rounded-lg font-medium transition-colors text-sm sm:text-base ${selectedMonth === month ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-200'}`}>
                {monthLabel[month]}
              </button>
            ))}
          </div>

          {/* Summary Stats */}
          {officeTotal && (
            <Card className="mb-4">
              <CardContent className="pt-4">
                <h2 className="text-lg sm:text-xl font-bold text-gray-900 mb-3 text-center">
                  {officeLabel[selectedOffice]} - {monthLabel[selectedMonth]}
                </h2>
                <div className="grid grid-cols-2 sm:grid-cols-5 gap-3">
                  <div className="bg-gray-50 rounded-lg p-3 text-center">
                    <div className="text-xs text-gray-500">Target</div>
                    <div className="text-lg font-bold text-gray-900">{formatCurrency(officeTotal.data.target)}</div>
                  </div>
                  <div className="bg-green-50 rounded-lg p-3 text-center">
                    <div className="text-xs text-gray-500">Confirmed</div>
                    <div className="text-lg font-bold text-green-600">{formatCurrency(officeTotal.data.confirmed)}</div>
                  </div>
                  <div className="bg-yellow-50 rounded-lg p-3 text-center">
                    <div className="text-xs text-gray-500">Unconfirmed</div>
                    <div className="text-lg font-bold text-yellow-600">{formatCurrency(officeTotal.data.unconfirmed)}</div>
                  </div>
                  <div className={`rounded-lg p-3 text-center ${officeTotal.data.total >= officeTotal.data.target ? 'bg-green-50' : 'bg-red-50'}`}>
                    <div className="text-xs text-gray-500">Variance</div>
                    <div className={`text-lg font-bold ${officeTotal.data.total >= officeTotal.data.target ? 'text-green-600' : 'text-red-600'}`}>
                      {officeTotal.data.total >= officeTotal.data.target ? '+' : ''}{formatCurrency(officeTotal.data.total - officeTotal.data.target)}
                    </div>
                  </div>
                  <div className={`rounded-lg p-3 text-center col-span-2 sm:col-span-1 ${(officeTotal.data.total / officeTotal.data.target) >= 0.95 ? 'bg-green-50' : (officeTotal.data.total / officeTotal.data.target) >= 0.85 ? 'bg-yellow-50' : 'bg-red-50'}`}>
                    <div className="text-xs text-gray-500">% Complete</div>
                    <div className={`text-lg font-bold ${(officeTotal.data.total / officeTotal.data.target) >= 0.95 ? 'text-green-600' : (officeTotal.data.total / officeTotal.data.target) >= 0.85 ? 'text-yellow-600' : 'text-red-600'}`}>
                      {((officeTotal.data.total / officeTotal.data.target) * 100).toFixed(1)}%
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          )}

          {/* 3-Month Trend Chart */}
          <Card className="mb-4">
            <CardHeader className="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3">
              <h2 className="text-base sm:text-xl font-bold">3-Month Trend</h2>
              <p className="text-blue-100 text-xs sm:text-sm">Dec ‚Üí Jan ‚Üí Feb</p>
            </CardHeader>
            <CardContent className="pt-4">
              <TrendChart data={monthlyTrendData} title="Revenue vs Target" />
              <div className="mt-4 grid grid-cols-3 gap-2 text-center">
                {monthlyTrendData.map((month, idx) => {
                  const variance = month.revenue - month.target;
                  return (
                    <div key={idx} className="bg-gray-50 p-2 sm:p-3 rounded-lg">
                      <div className="text-xs text-gray-600">{month.month}</div>
                      <div className="text-sm sm:text-lg font-bold text-blue-700">{formatCurrency(month.revenue)}</div>
                      <div className={`text-xs font-semibold ${variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {variance >= 0 ? '+' : ''}{formatCurrency(variance)}
                      </div>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>

          {/* Office Total Waterfall */}
          {officeTotal && (
            <Card className="mb-4">
              <CardHeader className="bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-3">
                <div className="flex justify-between items-center flex-wrap gap-2">
                  <h2 className="text-base sm:text-xl font-bold">{officeTotal.name}</h2>
                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${(officeTotal.data.total / officeTotal.data.target) >= 0.95 ? 'bg-green-200 text-green-900' : (officeTotal.data.total / officeTotal.data.target) >= 0.85 ? 'bg-yellow-200 text-yellow-900' : 'bg-red-200 text-red-900'}`}>
                    {((officeTotal.data.total / officeTotal.data.target) * 100).toFixed(1)}%
                  </span>
                </div>
              </CardHeader>
              <CardContent className="pt-4">
                <WaterfallChart data={officeTotal.data} teamName={officeTotal.name} />
              </CardContent>
            </Card>
          )}

          {/* Team Cards */}
          {getCurrentData().map(team => {
            const total = team.data.confirmed + team.data.unconfirmed;
            const pctComplete = (total / team.data.target) * 100;
            return (
              <Card key={team.key} className="mb-4">
                <CardHeader className="bg-gradient-to-r from-green-600 to-teal-600 text-white py-3">
                  <div className="flex justify-between items-center flex-wrap gap-2">
                    <h2 className="text-base sm:text-xl font-bold">{team.name}</h2>
                    <div className="text-xs sm:text-sm">
                      <span className={pctComplete >= 95 ? 'text-green-200' : pctComplete >= 85 ? 'text-yellow-200' : 'text-red-200'}>
                        {pctComplete.toFixed(1)}%
                      </span>
                    </div>
                  </div>
                </CardHeader>
                <CardContent className="pt-4">
                  <WaterfallChart data={team.data} teamName={team.name} />
                </CardContent>
              </Card>
            );
          })}

          {/* Melbourne Team Trends */}
          {selectedOffice === 'melbourne' && teamTrendData && (
            <Card className="mb-4">
              <CardHeader className="bg-gradient-to-r from-orange-600 to-red-600 text-white py-3">
                <h2 className="text-base sm:text-xl font-bold">Melbourne Team Trends</h2>
              </CardHeader>
              <CardContent className="pt-4">
                <TeamTrendChart data={teamTrendData} />
              </CardContent>
            </Card>
          )}

          {/* Top 5 Clients */}
          <Card className="mb-4">
            <CardHeader className="bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3">
              <h2 className="text-base sm:text-xl font-bold">Top 5 Clients</h2>
              <p className="text-green-100 text-xs">{officeLabel[selectedOffice]} - {monthLabel[selectedMonth]}</p>
            </CardHeader>
            <CardContent className="pt-4">
              <div className="space-y-2">
                {getTopClients().map((client, idx) => (
                  <div key={idx} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <span className={`flex items-center justify-center w-7 h-7 rounded-full text-sm font-bold ${idx === 0 ? 'bg-yellow-100 text-yellow-800' : idx === 1 ? 'bg-gray-200 text-gray-800' : idx === 2 ? 'bg-orange-100 text-orange-800' : 'bg-blue-50 text-blue-700'}`}>
                        {idx + 1}
                      </span>
                      <div>
                        <div className="font-semibold text-gray-900 text-sm">{client.client}</div>
                        <div className="text-xs text-gray-500">{client.team}</div>
                      </div>
                    </div>
                    <div className="font-bold text-blue-700 text-sm">{formatCurrency(client.revenue)}</div>
                  </div>
                ))}
                {getTopClients().length > 0 && (
                  <div className="flex justify-between p-3 bg-blue-50 rounded-lg font-semibold">
                    <span>Top 5 Total</span>
                    <span className="text-blue-700">{formatCurrency(getTopClients().reduce((sum, c) => sum + c.revenue, 0))}</span>
                  </div>
                )}
              </div>
            </CardContent>
          </Card>

          {/* Key Insights */}
          <Card>
            <CardHeader className="bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-3">
              <h2 className="text-base sm:text-xl font-bold">Key Insights</h2>
            </CardHeader>
            <CardContent className="pt-4">
              {officeTotal && (() => {
                const pct = (officeTotal.data.total / officeTotal.data.target) * 100;
                const gap = Math.max(0, officeTotal.data.target - officeTotal.data.total);
                return (
                  <div className="space-y-3">
                    {pct >= 95 ? (
                      <div className="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                        <h3 className="font-bold text-green-900 text-sm mb-1">‚úÖ On Track</h3>
                        <p className="text-green-800 text-sm">{officeLabel[selectedOffice]} at {pct.toFixed(1)}% of target. Strong performance!</p>
                      </div>
                    ) : pct >= 80 ? (
                      <div className="bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded">
                        <h3 className="font-bold text-yellow-900 text-sm mb-1">‚ö†Ô∏è Attention Needed</h3>
                        <p className="text-yellow-800 text-sm">{officeLabel[selectedOffice]} at {pct.toFixed(1)}% of target. Gap: {formatCurrency(gap)}</p>
                      </div>
                    ) : (
                      <div className="bg-red-50 border-l-4 border-red-500 p-3 rounded">
                        <h3 className="font-bold text-red-900 text-sm mb-1">üî¥ Critical Gap</h3>
                        <p className="text-red-800 text-sm">{officeLabel[selectedOffice]} at {pct.toFixed(1)}% of target. Gap: {formatCurrency(gap)} requires action.</p>
                      </div>
                    )}
                    {officeTotal.data.unconfirmed > 0 && (
                      <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded">
                        <h3 className="font-bold text-blue-900 text-sm mb-1">üìä Pipeline</h3>
                        <p className="text-blue-800 text-sm">Unconfirmed: {formatCurrency(officeTotal.data.unconfirmed)} ({((officeTotal.data.unconfirmed / officeTotal.data.target) * 100).toFixed(1)}%). Focus on conversion.</p>
                      </div>
                    )}
                  </div>
                );
              })()}
            </CardContent>
          </Card>
          
          <div className="text-center text-gray-400 text-xs mt-6 pb-4">
            Alt/Shift Revenue Dashboard ‚Ä¢ {updateDate}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<Rolling3MonthDashboard />);
    </script>
</body>
</html>