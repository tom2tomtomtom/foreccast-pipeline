<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rolling 3-Month Revenue Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
        .card { background: white; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); overflow: hidden; }
        .card-header { padding: 1rem 1.5rem; }
        .card-content { padding: 1.5rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.2s; cursor: pointer; border: none; font-size: 0.875rem; }
        .btn-active { background: #2563eb; color: white; }
        .btn-inactive { background: white; color: #374151; border: 1px solid #e5e7eb; }
        .btn-inactive:hover { background: #f3f4f6; }
        .btn-month-active { background: #7c3aed; color: white; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 1rem; }
        #dashboard { display: none; }
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        @media (max-width: 768px) {
            .card-header { padding: 0.75rem 1rem; }
            .card-content { padding: 1rem; }
            .btn { padding: 0.4rem 0.75rem; font-size: 0.75rem; }
            h1 { font-size: 1.5rem !important; }
            .summary-grid { grid-template-columns: repeat(2, 1fr) !important; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="login-screen">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold text-gray-900 mb-4 text-center">Revenue Dashboard</h2>
            <input type="password" id="password-input" placeholder="Enter password" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()" 
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Access Dashboard</button>
            <p id="error-msg" class="text-red-600 text-sm mt-2 text-center" style="display:none;">Incorrect password</p>
        </div>
    </div>
    
    <div id="dashboard">
        <div class="w-full max-w-7xl mx-auto p-4 sm:p-6">
            <div class="mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Rolling 3-Month Revenue Dashboard</h1>
                <p class="text-gray-600">December (Current) + January + February (Forward Looking)</p>
                <div class="mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p class="text-sm text-blue-900"><strong>üìä Updated:</strong> 9 December 2025</p>
                </div>
            </div>

            <div class="mb-4 flex gap-2 flex-wrap">
                <button class="btn btn-active" id="btn-melbourne" onclick="selectOffice('melbourne')">Melbourne</button>
                <button class="btn btn-inactive" id="btn-sydney" onclick="selectOffice('sydney')">Sydney</button>
                <button class="btn btn-inactive" id="btn-brisbane" onclick="selectOffice('brisbane')">Brisbane</button>
                <button class="btn btn-inactive" id="btn-group" onclick="selectOffice('group')">üåê Group</button>
            </div>

            <div class="mb-6 flex gap-2 flex-wrap">
                <button class="btn btn-inactive" id="btn-dec" onclick="selectMonth('dec')">December</button>
                <button class="btn btn-inactive" id="btn-jan" onclick="selectMonth('jan')">January</button>
                <button class="btn btn-inactive" id="btn-feb" onclick="selectMonth('feb')">February</button>
                <button class="btn btn-month-active" id="btn-rolling" onclick="selectMonth('rolling')">Rolling 3M</button>
            </div>

            <!-- Summary Cards -->
            <div class="card mb-6">
                <div class="card-content">
                    <h2 class="text-xl font-bold text-gray-900 mb-4 text-center" id="summaryTitle">Melbourne - Rolling 3-Month</h2>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 summary-grid" id="summaryCards"></div>
                </div>
            </div>

            <!-- Waterfall Chart -->
            <div class="card mb-6">
                <div class="card-header text-white" style="background: linear-gradient(to right, #4f46e5, #7c3aed);">
                    <div class="flex justify-between items-center flex-wrap gap-2">
                        <h2 class="text-lg sm:text-xl font-bold" id="chartTitle">Revenue Waterfall</h2>
                        <span class="px-3 py-1 rounded-full text-sm font-medium bg-white/20" id="completeBadge">0% Complete</span>
                    </div>
                </div>
                <div class="card-content">
                    <div id="waterfallChart" style="height: 400px; width: 100%;"></div>
                    <div class="mt-4 bg-blue-50 p-4 rounded-lg">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm" id="waterfallBreakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Team Breakdown (Melbourne only) -->
            <div class="card mb-6" id="teamBreakdown" style="display: none;">
                <div class="card-header text-white" style="background: linear-gradient(to right, #059669, #0d9488);">
                    <h2 class="text-lg sm:text-xl font-bold">Melbourne Team Breakdown</h2>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="w-full" id="teamTable"></table>
                    </div>
                </div>
            </div>

            <!-- Top 5 Clients -->
            <div class="card mb-6">
                <div class="card-header text-white" style="background: linear-gradient(to right, #059669, #10b981);">
                    <h2 class="text-lg sm:text-xl font-bold" id="clientsTitle">Top 5 Clients</h2>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="w-full" id="clientsTable"></table>
                    </div>
                </div>
            </div>

            <!-- Office Comparison (Group view) -->
            <div class="card mb-6" id="officeComparison" style="display: none;">
                <div class="card-header text-white" style="background: linear-gradient(to right, #2563eb, #3b82f6);">
                    <h2 class="text-lg sm:text-xl font-bold">Office Comparison</h2>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="w-full" id="officeTable"></table>
                    </div>
                </div>
            </div>

            <!-- Key Insights -->
            <div class="card">
                <div class="card-header text-white" style="background: linear-gradient(to right, #dc2626, #ef4444);">
                    <h2 class="text-lg sm:text-xl font-bold">Key Insights</h2>
                </div>
                <div class="card-content" id="insights"></div>
            </div>
        </div>
    </div>

    <script>
const PASSWORD = 'altshift2025';
const data = {"melbourne":{"dreamTeam":{"name":"Dream Team","dec":{"target":140000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":126018,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":161460,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":427478,"confirmed":0,"unconfirmed":0,"total":0}},"goGetters":{"name":"Go-Getters","dec":{"target":60000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":90619,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":116106,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":266725,"confirmed":0,"unconfirmed":0,"total":0}},"socialContent":{"name":"Social & Content","dec":{"target":125000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":103363,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":132434,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":360797,"confirmed":0,"unconfirmed":0,"total":0}},"total":{"name":"Melbourne Total","dec":{"target":325000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":320000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":410000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":1055000,"confirmed":0,"unconfirmed":0,"total":0}}},"sydney":{"sydney":{"name":"Sydney","dec":{"target":40000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":40000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":50000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":130000,"confirmed":0,"unconfirmed":0,"total":0}},"total":{"name":"Sydney Total","dec":{"target":40000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":40000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":50000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":130000,"confirmed":0,"unconfirmed":0,"total":0}}},"brisbane":{"brisbane":{"name":"Brisbane","dec":{"target":75000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":90000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":100000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":265000,"confirmed":0,"unconfirmed":0,"total":0}},"total":{"name":"Brisbane Total","dec":{"target":75000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":90000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":100000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":265000,"confirmed":0,"unconfirmed":0,"total":0}}},"group":{"total":{"name":"Group Total","dec":{"target":440000,"confirmed":0,"unconfirmed":0,"total":0},"jan":{"target":450000,"confirmed":0,"unconfirmed":0,"total":0},"feb":{"target":560000,"confirmed":0,"unconfirmed":0,"total":0},"rolling":{"target":1450000,"confirmed":0,"unconfirmed":0,"total":0}}}};
const topClientsData = {"dec":{"dreamTeam":[],"goGetters":[],"socialContent":[],"melbourne":[],"sydney":[],"brisbane":[],"group":[]},"jan":{"dreamTeam":[],"goGetters":[],"socialContent":[],"melbourne":[],"sydney":[],"brisbane":[],"group":[]},"feb":{"dreamTeam":[],"goGetters":[],"socialContent":[],"melbourne":[],"sydney":[],"brisbane":[],"group":[]},"rolling":{"dreamTeam":[],"goGetters":[],"socialContent":[],"melbourne":[],"sydney":[],"brisbane":[],"group":[]}};

let currentOffice = 'melbourne';
let currentMonth = 'rolling';

function checkPassword() {
    const input = document.getElementById('password-input').value;
    if (input === PASSWORD) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        sessionStorage.setItem('authenticated', 'true');
    } else {
        document.getElementById('error-msg').style.display = 'block';
        document.getElementById('password-input').value = '';
    }
}

if (sessionStorage.getItem('authenticated') === 'true') {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
}

document.getElementById('password-input')?.focus();

function formatCurrency(value) { 
    return '$' + Math.round(value / 1000) + 'k'; 
}

function formatFullCurrency(value) {
    return '$' + value.toLocaleString('en-AU', { maximumFractionDigits: 0 });
}

function selectOffice(office) {
    currentOffice = office;
    ['melbourne', 'sydney', 'brisbane', 'group'].forEach(o => {
        document.getElementById('btn-' + o).className = o === office ? 'btn btn-active' : 'btn btn-inactive';
    });
    updateDisplay();
}

function selectMonth(month) {
    currentMonth = month;
    ['dec', 'jan', 'feb', 'rolling'].forEach(m => {
        document.getElementById('btn-' + m).className = m === month ? 'btn btn-month-active' : 'btn btn-inactive';
    });
    updateDisplay();
}

function getOfficeData() {
    return data[currentOffice]?.total?.[currentMonth];
}

function drawWaterfall(d) {
    if (!d) return;
    const container = document.getElementById('waterfallChart');
    container.innerHTML = '';
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('viewBox', '0 0 700 380');
    svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    svg.style.width = '100%';
    svg.style.height = '100%';
    
    const h = 280, w = 90, g = 45;
    const total = d.confirmed + d.unconfirmed;
    const exceeding = total > d.target;
    const maxVal = Math.max(d.target, total) * 1.15;
    
    const getY = v => 50 + h - (v / maxVal * h);
    const getH = v => v / maxVal * h;
    
    const x1 = 80, x2 = x1 + w + g, x3 = x2 + w + g, x4 = x3 + w + g;
    const targetY = getY(d.target);
    const confirmedY = getY(d.confirmed);
    const confirmedH = getH(d.confirmed);
    const totalY = getY(total);
    const unconfirmedH = getH(d.unconfirmed);
    const gapVal = exceeding ? 0 : d.target - total;
    const gapH = getH(gapVal);
    
    let html = '';
    
    // Grid lines
    html += '<line x1="60" y1="50" x2="650" y2="50" stroke="#e5e7eb" stroke-width="1"/>';
    html += '<line x1="60" y1="' + (50 + h) + '" x2="650" y2="' + (50 + h) + '" stroke="#e5e7eb" stroke-width="2"/>';
    
    // Target line
    html += '<line x1="60" y1="' + targetY + '" x2="650" y2="' + targetY + '" stroke="#ef4444" stroke-width="2" stroke-dasharray="5,5"/>';
    html += '<text x="655" y="' + (targetY + 4) + '" font-size="11" fill="#ef4444" font-weight="bold">Target</text>';
    
    // Confirmed bar
    html += '<rect x="' + x1 + '" y="' + confirmedY + '" width="' + w + '" height="' + confirmedH + '" fill="#10b981" stroke="#059669" stroke-width="2" rx="4"/>';
    html += '<text x="' + (x1 + w/2) + '" y="' + (confirmedY - 8) + '" font-size="13" font-weight="bold" fill="#059669" text-anchor="middle">' + formatCurrency(d.confirmed) + '</text>';
    html += '<text x="' + (x1 + w/2) + '" y="' + (confirmedY - 22) + '" font-size="10" fill="#059669" text-anchor="middle">' + ((d.confirmed/d.target)*100).toFixed(0) + '%</text>';
    html += '<text x="' + (x1 + w/2) + '" y="360" font-size="12" font-weight="bold" text-anchor="middle">Confirmed</text>';
    
    // Connector line
    html += '<line x1="' + (x1 + w) + '" y1="' + confirmedY + '" x2="' + x2 + '" y2="' + confirmedY + '" stroke="#94a3b8" stroke-width="2" stroke-dasharray="3,3"/>';
    
    // Unconfirmed bar + base
    html += '<rect x="' + x2 + '" y="' + confirmedY + '" width="' + w + '" height="' + confirmedH + '" fill="#10b981" opacity="0.3" rx="4"/>';
    if (d.unconfirmed > 0) {
        html += '<rect x="' + x2 + '" y="' + totalY + '" width="' + w + '" height="' + unconfirmedH + '" fill="#fbbf24" stroke="#f59e0b" stroke-width="2" rx="4"/>';
        html += '<text x="' + (x2 + w/2) + '" y="' + (totalY - 8) + '" font-size="13" font-weight="bold" fill="#f59e0b" text-anchor="middle">' + formatCurrency(d.unconfirmed) + '</text>';
        html += '<text x="' + (x2 + w/2) + '" y="' + (totalY - 22) + '" font-size="10" fill="#f59e0b" text-anchor="middle">+' + ((d.unconfirmed/d.target)*100).toFixed(1) + '%</text>';
    }
    html += '<text x="' + (x2 + w/2) + '" y="360" font-size="12" font-weight="bold" text-anchor="middle">+ Unconfirmed</text>';
    
    // Connector line
    html += '<line x1="' + (x2 + w) + '" y1="' + totalY + '" x2="' + x3 + '" y2="' + totalY + '" stroke="#94a3b8" stroke-width="2" stroke-dasharray="3,3"/>';
    
    // Gap or Excess bar
    html += '<rect x="' + x3 + '" y="' + confirmedY + '" width="' + w + '" height="' + (confirmedH + unconfirmedH) + '" fill="#10b981" opacity="0.2" rx="4"/>';
    if (exceeding) {
        const excessVal = total - d.target;
        const excessH = getH(excessVal);
        html += '<rect x="' + x3 + '" y="' + totalY + '" width="' + w + '" height="' + excessH + '" fill="#d1fae5" stroke="#10b981" stroke-width="2" stroke-dasharray="4,4" rx="4"/>';
        html += '<text x="' + (x3 + w/2) + '" y="' + (totalY - 8) + '" font-size="13" font-weight="bold" fill="#10b981" text-anchor="middle">+' + formatCurrency(excessVal) + '</text>';
        html += '<text x="' + (x3 + w/2) + '" y="360" font-size="12" font-weight="bold" text-anchor="middle">Over Target</text>';
    } else if (gapVal > 0) {
        html += '<rect x="' + x3 + '" y="' + targetY + '" width="' + w + '" height="' + gapH + '" fill="#fee2e2" stroke="#ef4444" stroke-width="2" stroke-dasharray="4,4" rx="4"/>';
        html += '<text x="' + (x3 + w/2) + '" y="' + (targetY - 8) + '" font-size="13" font-weight="bold" fill="#ef4444" text-anchor="middle">' + formatCurrency(gapVal) + '</text>';
        html += '<text x="' + (x3 + w/2) + '" y="' + (targetY - 22) + '" font-size="10" fill="#ef4444" text-anchor="middle">-' + ((gapVal/d.target)*100).toFixed(1) + '%</text>';
        html += '<text x="' + (x3 + w/2) + '" y="360" font-size="12" font-weight="bold" text-anchor="middle">Gap</text>';
    }
    
    // Connector line
    html += '<line x1="' + (x3 + w) + '" y1="' + targetY + '" x2="' + x4 + '" y2="' + targetY + '" stroke="#94a3b8" stroke-width="2" stroke-dasharray="3,3"/>';
    
    // Target bar
    const targetH = getH(d.target);
    html += '<rect x="' + x4 + '" y="' + targetY + '" width="' + w + '" height="' + targetH + '" fill="none" stroke="#ef4444" stroke-width="3" rx="4"/>';
    html += '<text x="' + (x4 + w/2) + '" y="' + (targetY - 8) + '" font-size="13" font-weight="bold" fill="#ef4444" text-anchor="middle">' + formatCurrency(d.target) + '</text>';
    html += '<text x="' + (x4 + w/2) + '" y="360" font-size="12" font-weight="bold" text-anchor="middle">Target</text>';
    
    // Y-axis labels
    html += '<text x="55" y="55" font-size="10" fill="#6b7280" text-anchor="end">' + formatCurrency(maxVal) + '</text>';
    html += '<text x="55" y="' + (50 + h + 5) + '" font-size="10" fill="#6b7280" text-anchor="end">$0</text>';
    
    svg.innerHTML = html;
    container.appendChild(svg);
}

function updateDisplay() {
    const d = getOfficeData();
    if (!d) return;
    
    const officeNames = { melbourne: 'Melbourne', sydney: 'Sydney', brisbane: 'Brisbane', group: 'Group' };
    const monthNames = { dec: 'December', jan: 'January', feb: 'February', rolling: 'Rolling 3-Month' };
    const officeName = officeNames[currentOffice];
    const monthName = monthNames[currentMonth];
    
    // Summary title
    document.getElementById('summaryTitle').textContent = officeName + ' - ' + monthName;
    document.getElementById('chartTitle').textContent = officeName + ' Revenue Waterfall - ' + monthName;
    
    // Complete badge
    const pctComplete = ((d.confirmed + d.unconfirmed) / d.target * 100).toFixed(1);
    const badge = document.getElementById('completeBadge');
    badge.textContent = pctComplete + '% Complete';
    badge.className = 'px-3 py-1 rounded-full text-sm font-medium ' + 
        (pctComplete >= 95 ? 'bg-green-200 text-green-900' : pctComplete >= 80 ? 'bg-yellow-200 text-yellow-900' : 'bg-red-200 text-red-900');
    
    // Summary cards
    const gap = Math.max(0, d.target - d.confirmed - d.unconfirmed);
    const variance = d.total - d.target;
    document.getElementById('summaryCards').innerHTML = 
        '<div class="bg-gray-100 p-4 rounded-lg"><div class="text-sm text-gray-600">Target</div><div class="text-xl font-bold text-gray-900">' + formatCurrency(d.target) + '</div></div>' +
        '<div class="bg-green-50 p-4 rounded-lg"><div class="text-sm text-gray-600">Confirmed</div><div class="text-xl font-bold text-green-600">' + formatCurrency(d.confirmed) + '</div><div class="text-xs text-gray-500">' + ((d.confirmed/d.target)*100).toFixed(1) + '%</div></div>' +
        '<div class="bg-yellow-50 p-4 rounded-lg"><div class="text-sm text-gray-600">Unconfirmed</div><div class="text-xl font-bold text-yellow-600">' + formatCurrency(d.unconfirmed) + '</div><div class="text-xs text-gray-500">' + ((d.unconfirmed/d.target)*100).toFixed(1) + '%</div></div>' +
        '<div class="' + (gap > 0 ? 'bg-red-50' : 'bg-green-50') + ' p-4 rounded-lg"><div class="text-sm text-gray-600">' + (gap > 0 ? 'Gap' : 'Surplus') + '</div><div class="text-xl font-bold ' + (gap > 0 ? 'text-red-600' : 'text-green-600') + '">' + formatCurrency(gap > 0 ? gap : -variance) + '</div></div>' +
        '<div class="bg-blue-50 p-4 rounded-lg"><div class="text-sm text-gray-600">Variance</div><div class="text-xl font-bold ' + (variance >= 0 ? 'text-green-600' : 'text-red-600') + '">' + (variance >= 0 ? '+' : '') + formatCurrency(variance) + '</div></div>';
    
    // Waterfall breakdown
    document.getElementById('waterfallBreakdown').innerHTML = 
        '<div><div class="text-gray-700">Confirmed:</div><div class="font-bold text-green-700">' + formatCurrency(d.confirmed) + ' (' + ((d.confirmed/d.target)*100).toFixed(1) + '%)</div></div>' +
        '<div><div class="text-gray-700">Unconfirmed:</div><div class="font-bold text-yellow-700">' + formatCurrency(d.unconfirmed) + ' (' + ((d.unconfirmed/d.target)*100).toFixed(1) + '%)</div></div>' +
        '<div><div class="text-gray-700">Total Pipeline:</div><div class="font-bold text-blue-700">' + formatCurrency(d.total) + ' (' + ((d.total/d.target)*100).toFixed(1) + '%)</div></div>' +
        '<div><div class="text-gray-700">Gap to Close:</div><div class="font-bold ' + (gap > 0 ? 'text-red-700' : 'text-green-700') + '">' + (gap > 0 ? formatCurrency(gap) : 'EXCEEDED!') + '</div></div>';
    
    // Draw waterfall
    drawWaterfall(d);
    
    // Team breakdown (Melbourne only)
    const teamSection = document.getElementById('teamBreakdown');
    if (currentOffice === 'melbourne') {
        teamSection.style.display = 'block';
        const teams = [['dreamTeam', 'Dream Team'], ['goGetters', 'Go-Getters'], ['socialContent', 'Social & Content']];
        let tableHtml = '<thead class="bg-gray-100"><tr><th class="px-4 py-3 text-left">Team</th><th class="px-4 py-3 text-right">Target</th><th class="px-4 py-3 text-right">Confirmed</th><th class="px-4 py-3 text-right">Unconf.</th><th class="px-4 py-3 text-right">Total</th><th class="px-4 py-3 text-right">Gap</th><th class="px-4 py-3 text-center">%</th></tr></thead><tbody>';
        
        teams.forEach(([key, name]) => {
            const td = data.melbourne[key]?.[currentMonth];
            if (!td) return;
            const tGap = Math.max(0, td.target - td.total);
            const tPct = ((td.total / td.target) * 100).toFixed(0);
            const badge = tPct >= 95 ? 'bg-green-100 text-green-800' : tPct >= 80 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
            tableHtml += '<tr class="border-b"><td class="px-4 py-3 font-medium">' + name + '</td><td class="px-4 py-3 text-right">' + formatCurrency(td.target) + '</td><td class="px-4 py-3 text-right text-green-700">' + formatCurrency(td.confirmed) + '</td><td class="px-4 py-3 text-right text-yellow-700">' + formatCurrency(td.unconfirmed) + '</td><td class="px-4 py-3 text-right font-medium">' + formatCurrency(td.total) + '</td><td class="px-4 py-3 text-right text-red-600">' + formatCurrency(tGap) + '</td><td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded text-sm ' + badge + '">' + tPct + '%</span></td></tr>';
        });
        
        tableHtml += '<tr class="bg-blue-50 font-bold"><td class="px-4 py-3">TOTAL</td><td class="px-4 py-3 text-right">' + formatCurrency(d.target) + '</td><td class="px-4 py-3 text-right text-green-700">' + formatCurrency(d.confirmed) + '</td><td class="px-4 py-3 text-right text-yellow-700">' + formatCurrency(d.unconfirmed) + '</td><td class="px-4 py-3 text-right">' + formatCurrency(d.total) + '</td><td class="px-4 py-3 text-right text-red-700">' + formatCurrency(gap) + '</td><td class="px-4 py-3 text-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">' + pctComplete + '%</span></td></tr></tbody>';
        document.getElementById('teamTable').innerHTML = tableHtml;
    } else {
        teamSection.style.display = 'none';
    }
    
    // Top 5 Clients
    document.getElementById('clientsTitle').textContent = 'Top 5 Clients - ' + officeName + ' (' + monthName + ')';
    const clientKey = currentOffice === 'group' ? 'group' : currentOffice === 'melbourne' ? 'melbourne' : currentOffice;
    const clients = topClientsData[currentMonth]?.[clientKey] || [];
    let clientsHtml = '<thead class="bg-gray-100"><tr><th class="px-4 py-3 text-left">#</th><th class="px-4 py-3 text-left">Client</th><th class="px-4 py-3 text-left">Team</th><th class="px-4 py-3 text-right">Revenue</th></tr></thead><tbody>';
    clients.forEach((c, i) => {
        const rankBg = i === 0 ? 'bg-yellow-100 text-yellow-800' : i === 1 ? 'bg-gray-200 text-gray-800' : i === 2 ? 'bg-orange-100 text-orange-800' : 'bg-blue-50 text-blue-700';
        clientsHtml += '<tr class="border-b"><td class="px-4 py-3"><span class="inline-flex items-center justify-center w-8 h-8 rounded-full font-bold ' + rankBg + '">' + (i+1) + '</span></td><td class="px-4 py-3 font-semibold">' + c.client + '</td><td class="px-4 py-3 text-gray-600">' + c.team + '</td><td class="px-4 py-3 text-right font-bold text-blue-700">' + formatCurrency(c.revenue) + '</td></tr>';
    });
    const clientTotal = clients.reduce((sum, c) => sum + c.revenue, 0);
    clientsHtml += '<tr class="bg-blue-50 font-bold"><td colspan="3" class="px-4 py-3">Top 5 Total</td><td class="px-4 py-3 text-right text-blue-700">' + formatCurrency(clientTotal) + '</td></tr></tbody>';
    document.getElementById('clientsTable').innerHTML = clientsHtml;
    
    // Office comparison (Group only)
    const officeSection = document.getElementById('officeComparison');
    if (currentOffice === 'group') {
        officeSection.style.display = 'block';
        let officeHtml = '<thead class="bg-gray-100"><tr><th class="px-4 py-3 text-left">Office</th><th class="px-4 py-3 text-right">Target</th><th class="px-4 py-3 text-right">Confirmed</th><th class="px-4 py-3 text-right">Unconf.</th><th class="px-4 py-3 text-right">Total</th><th class="px-4 py-3 text-center">%</th></tr></thead><tbody>';
        
        ['melbourne', 'sydney', 'brisbane'].forEach(office => {
            const od = data[office]?.total?.[currentMonth];
            if (!od) return;
            const oPct = ((od.total / od.target) * 100).toFixed(0);
            const badge = oPct >= 95 ? 'bg-green-100 text-green-800' : oPct >= 80 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
            officeHtml += '<tr class="border-b"><td class="px-4 py-3 font-medium capitalize">' + office + '</td><td class="px-4 py-3 text-right">' + formatCurrency(od.target) + '</td><td class="px-4 py-3 text-right text-green-700">' + formatCurrency(od.confirmed) + '</td><td class="px-4 py-3 text-right text-yellow-700">' + formatCurrency(od.unconfirmed) + '</td><td class="px-4 py-3 text-right font-medium">' + formatCurrency(od.total) + '</td><td class="px-4 py-3 text-center"><span class="px-2 py-1 rounded text-sm ' + badge + '">' + oPct + '%</span></td></tr>';
        });
        
        officeHtml += '<tr class="bg-blue-50 font-bold"><td class="px-4 py-3">GROUP TOTAL</td><td class="px-4 py-3 text-right">' + formatCurrency(d.target) + '</td><td class="px-4 py-3 text-right text-green-700">' + formatCurrency(d.confirmed) + '</td><td class="px-4 py-3 text-right text-yellow-700">' + formatCurrency(d.unconfirmed) + '</td><td class="px-4 py-3 text-right">' + formatCurrency(d.total) + '</td><td class="px-4 py-3 text-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">' + pctComplete + '%</span></td></tr></tbody>';
        document.getElementById('officeTable').innerHTML = officeHtml;
    } else {
        officeSection.style.display = 'none';
    }
    
    // Key Insights
    let insightsHtml = '';
    const pct = parseFloat(pctComplete);
    
    if (pct >= 95) {
        insightsHtml += '<div class="bg-green-50 border-l-4 border-green-500 p-4 rounded mb-4"><h3 class="font-bold text-green-900 mb-2">‚úÖ On Track</h3><p class="text-green-800">' + officeName + ' is at ' + pctComplete + '% of ' + monthName + ' target. Strong performance!</p></div>';
    } else if (pct >= 80) {
        insightsHtml += '<div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded mb-4"><h3 class="font-bold text-yellow-900 mb-2">‚ö†Ô∏è Attention Needed</h3><p class="text-yellow-800">' + officeName + ' is at ' + pctComplete + '% of ' + monthName + ' target. Gap of ' + formatCurrency(gap) + ' to close.</p></div>';
    } else {
        insightsHtml += '<div class="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-4"><h3 class="font-bold text-red-900 mb-2">üî¥ Critical Gap</h3><p class="text-red-800">' + officeName + ' is at ' + pctComplete + '% of ' + monthName + ' target. Significant gap of ' + formatCurrency(gap) + ' requires immediate action.</p></div>';
    }
    
    if (d.unconfirmed > 0) {
        insightsHtml += '<div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded"><h3 class="font-bold text-blue-900 mb-2">üìä Pipeline Status</h3><p class="text-blue-800">Unconfirmed pipeline of ' + formatCurrency(d.unconfirmed) + ' (' + ((d.unconfirmed/d.target)*100).toFixed(1) + '% of target). Focus on converting to confirmed revenue.</p></div>';
    }
    
    document.getElementById('insights').innerHTML = insightsHtml;
}

// Initialize
updateDisplay();
    </script>
</body>
</html>